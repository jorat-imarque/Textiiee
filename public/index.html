  <!DOCTYPE html>
<html>
<head>
    <title>Textiiee</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#541aff">

    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>

.btn-defualt {
    border: none !important; 
    background-color: #882cfe !important;
    margin: 1px !important; 
    color: white;
}

    </style>

</head>
<body>
    <div class="container-fluid" style="background-color: #e9d8ff !important;">
     <div class="row">
            <div class="col-md-12 p-1">
                <div class="card shadow">
                    <div class="card-header d-flex">
                        <button class="btn btn-sm btn-defualt ms-auto" id="RefreshVideoButton">
                            <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor" class="bi bi-gear-wide-connected" viewBox="0 0 16 16">
                            <path d="M7.068.727c.243-.97 1.62-.97 1.864 0l.071.286a.96.96 0 0 0 1.622.434l.205-.211c.695-.719 1.888-.03 1.613.931l-.08.284a.96.96 0 0 0 1.187 1.187l.283-.081c.96-.275 1.65.918.931 1.613l-.211.205a.96.96 0 0 0 .434 1.622l.286.071c.97.243.97 1.62 0 1.864l-.286.071a.96.96 0 0 0-.434 1.622l.211.205c.719.695.03 1.888-.931 1.613l-.284-.08a.96.96 0 0 0-1.187 1.187l.081.283c.275.96-.918 1.65-1.613.931l-.205-.211a.96.96 0 0 0-1.622.434l-.071.286c-.243.97-1.62.97-1.864 0l-.071-.286a.96.96 0 0 0-1.622-.434l-.205.211c-.695.719-1.888.03-1.613-.931l.08-.284a.96.96 0 0 0-1.186-1.187l-.284.081c-.96.275-1.65-.918-.931-1.613l.211-.205a.96.96 0 0 0-.434-1.622l-.286-.071c-.97-.243-.97-1.62 0-1.864l.286-.071a.96.96 0 0 0 .434-1.622l-.211-.205c-.719-.695-.03-1.888.931-1.613l.284.08a.96.96 0 0 0 1.187-1.186l-.081-.284c-.275-.96.918-1.65 1.613-.931l.205.211a.96.96 0 0 0 1.622-.434l.071-.286zM12.973 8.5H8.25l-2.834 3.779A4.998 4.998 0 0 0 12.973 8.5zm0-1a4.998 4.998 0 0 0-7.557-3.779l2.834 3.78h4.723zM5.048 3.967c-.03.021-.058.043-.087.065l.087-.065zm-.431.355A4.984 4.984 0 0 0 3.002 8c0 1.455.622 2.765 1.615 3.678L7.375 8 4.617 4.322zm.344 7.646.087.065-.087-.065z"/>
                          </svg>  
                        </button>
    
                      <input type="text" class="form-control" id="videoUrlInput" placeholder="Enter Video URL">
                            <button class="btn btn-sm btn-defualt ms-auto" id="loadVideoButton">
                                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor" class="bi bi-play-btn" viewBox="0 0 16 16">
                                    <path d="M6.79 5.093A.5.5 0 0 0 6 5.5v5a.5.5 0 0 0 .79.407l3.5-2.5a.5.5 0 0 0 0-.814l-3.5-2.5z"/>
                                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                                  </svg>

                            </button>
                    </div>
                    <div class="card-body">
                        
                        <video id="myVideo" width="100%" height="240" controls class="mt-3">
                            <source src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>


                    <div class="card-footer">
                        <div class="row p-1">
                            <form class="d-flex"  enctype="multipart/form-data" action="/upload" method="post">
                            <div class="col-10 shadow p-1">
                                    <input class="form-control"  type="file" name="file" id="file">
                                </div>
                                <div class="col-2 shadow p-1" >
                                    <button class="btn btn-defualt btn-block" style="width: 100%;"  type="submit">Upload</button>
                                </div>
                        </form>
                </div>
                    </div>                        
                </div>
            </div>
            <div class="col-md-12 shadow">
              
                <div class="table table-responsive">
              
                    <table id="fileTable" class="table table-sm table-bordered " style="display: none;">
                      <thead>
                        <tr>
                          <th>Files</th>
                        </tr>
                      </thead>
                      <tbody id="fileList"></tbody>
                    </table>
                  </div>
            </div>
        </div>
    </div>
  
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.min.js"></script>
   
    <script>

        if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
        .then(function(registration) {
            console.log('Service Worker registered with scope:', registration.scope);
        })
        .catch(function(error) {
            console.error('Service Worker registration failed:', error);
        });
         }
      </script>

    <script>
        $(document).ready(function() {
            var video = $("#myVideo")[0]; 
            var videoUrlInput = $("#videoUrlInput");
            var loadVideoButton = $("#loadVideoButton");
            var RefreshVideoButton = $("#RefreshVideoButton");
            var previousPlaybackTime = 0;
            var previousPausedState = false;

            
        $(document).ready(function() {
            setTimeout(function() {
               $.ajax({
                    url: '/readData',
                    dataType: 'json',
                    success: function(data) {
                         var currentTime = data.playbackTime || 0;
                        var isPaused = data.isPaused || false;
                        var storedUrl = data.videoUrl || '';
                        videoUrlInput.value=videoUrlInput;
                        console.log(storedUrl);
                         if (isPaused) {
                            video.currentTime = currentTime;
                            previousPlaybackTime = currentTime;
                            video.src = storedUrl;
                            video.pause();
                        }else{
                            video.currentTime = currentTime;
                            previousPlaybackTime = currentTime;
                            video.src = storedUrl;
                            video.play();
                        }
                    },
                    error: function(error) {
                        console.error('Error:', error);
                    }
                });
            }, 500);  
        });


            loadVideoButton.click(function () {
                var videoUrl = videoUrlInput.val();
                if (videoUrl) {
                    var data = {
                        videoUrl: videoUrl,
                        playbackTime: 0,
                        isPaused: true
                    };
                    $.ajax({
                        url: '/saveData',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(data),
                        success: function() {
                            console.log('Video URL saved.' + videoUrl);
                             video.src = videoUrl;
                            video.load(); 
                            video.play(); 
                        },
                        error: function(error) {
                            console.error('Error:', error);
                        }
                    });
                }
            });

   
           // setPlaybackTimeAndState();
            function setPlaybackTimeAndState() {
                $.ajax({
                    url: '/readData',
                    dataType: 'json',
                    success: function(data) {
                        var currentTime = data.playbackTime || 0;
                        var isPaused = data.isPaused || false;
                        var storedUrl = data.videoUrl || '';
                        $("#videoUrlInput").val(storedUrl);
                        if (storedUrl && storedUrl === video.currentSrc) {
                            if (!isPaused) {
                                video.play();  
                            }
                        }
                       if (currentTime !== previousPlaybackTime) {
                            video.currentTime = currentTime;
                            previousPlaybackTime = currentTime;
                        }
                        previousPausedState = isPaused;
                    },
                    error: function(error) {
                        console.error('Error:', error);
                    }
                });
            }
            
            RefreshVideoButton.click(function () {
                setInterval(setPlaybackTimeAndState, 100);
                video.play();
            });

            video.addEventListener("play", function () {
                setInterval(setPlaybackTimeAndState, 100);
            });

            video.addEventListener("pause", function () {
                var currentTime = video.currentTime;
                var videoUrl = videoUrlInput.val();
                var data = {
                    videoUrl: videoUrl,
                    playbackTime: currentTime,
                    isPaused: true
                };
                $.ajax({
                    url: '/saveData',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function() {
                        console.log('Video Paused!');
                    },
                    error: function(error) {
                        console.error('Error:', error);
                    }
                });
            });

            // video.addEventListener("seeked", function () {
            //     var currentTime = video.currentTime;
            //     var videoUrl = videoUrlInput.val();
            //     var data = {
            //         videoUrl: videoUrl,
            //         playbackTime: currentTime,
            //         isPaused: false
            //     };
            //   $.ajax({
            //         url: '/saveData',
            //         type: 'POST',
            //         contentType: 'application/json',
            //         data: JSON.stringify(data),
            //         success: function() {
            //             console.log('1Video Seeked..');
            //         },
            //         error: function(error) {
            //             console.error('Error:', error);
            //         }
            //     });
            // });

            video.addEventListener("seeked", function () {
            var currentTime = video.currentTime;
            // Check if the current time has changed, indicating a seek operation
            if (currentTime !== previousPlaybackTime) {
                var videoUrl = videoUrlInput.val();
                var data = {
                    videoUrl: videoUrl,
                    playbackTime: currentTime,
                    isPaused: false
                };
                $.ajax({
                    url: '/saveData',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function() {
                        console.log('Video Seeked..');
                    },
                    error: function(error) {
                        console.error('Error:', error);
                    }
                });
                // Update the previousPlaybackTime after a seek
                previousPlaybackTime = currentTime;
            }
        });
         
        });
    </script>



<script>
    fetch('/listFiles')
      .then((response) => response.json())
      .then((data) => {
        const fileList = document.getElementById('fileList');
        data.forEach((file) => {
          const row = fileList.insertRow();
          const urlCell = row.insertCell(0);
        
  
          urlCell.innerHTML = `<a href="${file.url}" target="_blank">${file.url}</a>`;
        
        });
      })
      .catch((error) => {
        console.error('Error fetching file list:', error);
      });
  </script>

</body>
</html>
